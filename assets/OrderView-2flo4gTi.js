import{_ as O,o as n,c as l,d as e,t as o,D as v,F as g,e as y,w as k,I as M,m as L,r as h,f as p}from"./index-LlUqnSE7.js";import{a as m,u as C}from"./axios-DlGGDRsH.js";import{m as P}from"./modalMixin-VpIMK_6r.js";import{D,P as E}from"./PagePagination-UygO6GXf.js";import{L as V}from"./LoadingComponent-ujB0LiAI.js";import"./selector-engine-klkejVMR.js";const T={props:["order"],mixins:[P],data(){return{tempOrder:{}}},watch:{order(){this.tempOrder=this.order}},methods:{}},U={id:"productModal",ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},R={class:"modal-dialog modal-xl"},S={class:"modal-content border-0"},I=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{id:"productModalLabel",class:"modal-title"},[e("span",null,"訂單內容")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),A={class:"modal-body"},B={class:"row"},N={class:"col-md-4"},j=e("h3",{class:"fw-bold"},"用戶資料",-1),q={class:"table"},F={key:0},H=e("th",null,"姓名",-1),z=e("th",null,"Email",-1),G=e("th",null,"電話",-1),J=e("th",null,"地址",-1),K={class:"col-md-8"},Q=e("h3",{class:"fw-bold"},"訂單細節",-1),W={class:"table"},X=e("th",null,"訂單編號",-1),Y=e("th",null,"下單時間",-1),Z=e("th",null,"付款時間",-1),ee={key:0},te={key:1},se=e("th",null,"付款狀態",-1),oe={key:0,class:"text-success"},ne={key:1,class:"text-danger"},le=e("th",null,"總金額",-1),de=e("hr",null,null,-1),ae=e("h3",{class:"fw-bold"},"選購商品",-1),ie={class:"table"},re={class:"fs-5"},ce=e("tbody",null,null,-1),ue={class:"d-flex justify-content-end"},_e={class:"form-check"},he={class:"form-check-label",for:"flexCheckDefault"},pe={key:0,class:"fw-bold"},me={key:1},be={class:"modal-footer"},fe=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function ge(a,s,r,_,t,u){return n(),l("div",U,[e("div",R,[e("div",S,[I,e("div",A,[e("div",B,[e("div",N,[j,e("table",q,[t.tempOrder.user?(n(),l("tbody",F,[e("tr",null,[H,e("td",null,o(t.tempOrder.user.name),1)]),e("tr",null,[z,e("td",null,o(t.tempOrder.user.email),1)]),e("tr",null,[G,e("td",null,o(t.tempOrder.user.tel),1)]),e("tr",null,[J,e("td",null,o(t.tempOrder.user.address),1)])])):v("",!0)])]),e("div",K,[Q,e("table",W,[e("tbody",null,[e("tr",null,[X,e("td",null,o(t.tempOrder.id),1)]),e("tr",null,[Y,e("td",null,o(a.$filters.date(t.tempOrder.create_at)),1)]),e("tr",null,[Z,e("td",null,[t.tempOrder.paid_date?(n(),l("span",ee,o(t.tempOrder.paid_date),1)):(n(),l("span",te,"時間不確定"))])]),e("tr",null,[se,e("td",null,[t.tempOrder.is_paid?(n(),l("strong",oe," 已付款 ")):(n(),l("span",ne,"未付款"))])]),e("tr",null,[le,e("td",null,o(t.tempOrder.total),1)])])]),de,ae,e("table",ie,[e("thead",null,[(n(!0),l(g,null,y(t.tempOrder.products,i=>(n(),l("tr",{key:i.id},[e("th",re,o(i.product.title),1),e("td",null,o(i.qty)+" / "+o(i.product.unit),1),e("td",null,o(i.final_total),1)]))),128))]),ce]),e("div",ue,[e("div",_e,[k(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":s[0]||(s[0]=i=>t.tempOrder.is_paid=i)},null,512),[[M,t.tempOrder.is_paid]]),e("label",he,[t.tempOrder.is_paid?(n(),l("span",pe,"已付款")):(n(),l("span",me,"未付款"))])])])])])]),e("div",be,[fe,e("button",{type:"button",class:"btn btn-primary",onClick:s[1]||(s[1]=i=>a.$emit("update-paid",t.tempOrder))}," 修改付款狀態 ")])])])],512)}const ye=O(T,[["render",ge]]);var Oe={VITE_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_PATH:"wei_rio",BASE_URL:"/vue2024_week08/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:b,VITE_PATH:f}=Oe,ve={components:{OrderModal:ye,DelModal:D,PagePagination:E,LoadingComponent:V},data(){return{orders:{},pagination:{},isLoading:!1,tempOrder:{},currentPage:1}},created(){this.getOrder()},methods:{...L(C,["pushMessage"]),getOrder(a=1){this.currentPage=a;const s=`${b}api/${f}/admin/orders?page=${a}`;this.isLoading=!0,m.get(s).then(r=>{this.orders=r.data.orders,this.pagination=r.data.pagination,this.pushMessage({style:"success",title:"成功取得訂單明細",content:r.data.message})}).catch(r=>{this.pushMessage({style:"danger",title:"訂單明細取得失敗",content:r.response.data.message})}).finally(()=>{setTimeout(()=>{this.isLoading=!1},500)})},openModal(a,s){a==="edit"?(this.tempOrder={...s},this.$refs.orderModal.openModal()):a==="del"&&(this.tempOrder={...s},this.$refs.delModal.openModal())},updateOrder(a){this.isLoading=!0;const s=`${b}api/${f}/admin/order/${a.id}`,r={is_paid:a.is_paid};m.put(s,{data:r}).then(_=>{this.$refs.orderModal.hideModal(),this.getOrder(this.currentPage),this.pushMessage({style:"success",title:"更新付款狀態",content:_.data.message})}).catch(_=>{this.pushMessage({style:"danger",title:"錯誤訊息",content:_.response.data.message})}).finally(()=>{setTimeout(()=>{this.isLoading=!1},500)})},delOder(){this.isLoading=!0;const a=`${b}api/${f}/admin/order/${this.tempOrder.id}`;m.delete(a).then(s=>{this.$refs.delModal.hideModal(),this.getOrder(this.currentPage),this.pushMessage({style:"success",title:"成功刪除",content:s.data.message})}).catch(s=>{this.pushMessage({style:"danger",title:"錯誤訊息",content:s.response.data.message})}).finally(()=>{setTimeout(()=>{this.isLoading=!1},500)})}}},ke={class:"container"},Me=e("div",{class:"d-flex justify-content-between align-items-center"},[e("h2",{class:"my-4 fw-bold"},"訂單明細")],-1),xe={class:"table-responsive"},we={class:"table align-middle table-bordered"},$e=e("thead",{class:"fs-5"},[e("tr",{class:"table-active"},[e("th",{width:"150",class:"text-center d-none d-sm-table-cell"},"購買時間"),e("th",null,"Email"),e("th",{class:"d-none d-sm-table-cell"},"購買款項"),e("th",{width:"120"},"應付金額"),e("th",{width:"140",class:"text-center"},"是否付款"),e("th",{class:"text-center"},"編輯")])],-1),Le={class:"d-none d-sm-table-cell"},Ce=["textContent"],Pe={class:"d-none d-sm-table-cell"},De={class:"list-unstyled"},Ee={class:"form-check form-switch"},Ve=["id","onUpdate:modelValue","onChange"],Te=["for"],Ue={key:0,class:"text-success fw-bold"},Re={key:1,class:"text-danger"},Se={class:"text-center"},Ie={class:"btn-group flex-sm-row flex-column"},Ae=["onClick"],Be=["onClick"];function Ne(a,s,r,_,t,u){const i=h("OrderModal"),x=h("DelModal"),w=h("PagePagination"),$=h("LoadingComponent");return n(),l("div",ke,[Me,e("div",xe,[e("table",we,[$e,e("tbody",null,[(n(!0),l(g,null,y(t.orders,d=>(n(),l("tr",{key:d.id},[e("td",Le,o(a.$filters.date(d.create_at)),1),e("td",null,[d.user?(n(),l("span",{key:0,textContent:o(d.user.email)},null,8,Ce)):v("",!0)]),e("td",Pe,[e("ul",De,[(n(!0),l(g,null,y(d.products,c=>(n(),l("li",{key:c.id},o(c.product.title)+" / "+o(c.qty)+" "+o(c.product.unit),1))),128))])]),e("td",null,o(d.total),1),e("td",null,[e("div",Ee,[k(e("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${d.id}`,"onUpdate:modelValue":c=>d.is_paid=c,onChange:c=>u.updateOrder(d)},null,40,Ve),[[M,d.is_paid]]),e("label",{class:"form-check-label",for:`paidSwitch${d.id}`},[d.is_paid?(n(),l("span",Ue,"付款")):(n(),l("span",Re,"未付款"))],8,Te)])]),e("td",Se,[e("div",Ie,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm mb-sm-0 mb-2",onClick:c=>u.openModal("edit",d)}," 編輯 ",8,Ae),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:c=>u.openModal("del",d)}," 刪除 ",8,Be)])])]))),128))])])]),p(i,{order:t.tempOrder,onUpdatePaid:u.updateOrder,ref:"orderModal"},null,8,["order","onUpdatePaid"]),p(x,{"out-item":t.tempOrder,onRemoveData:u.delOder,ref:"delModal"},null,8,["out-item","onRemoveData"]),p(w,{pages:t.pagination,onEmitPages:u.getOrder},null,8,["pages","onEmitPages"]),p($,{active:t.isLoading,"onUpdate:active":s[0]||(s[0]=d=>t.isLoading=d)},null,8,["active"])])}const Je=O(ve,[["render",Ne]]);export{Je as default};
