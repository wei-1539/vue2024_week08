import{_ as v,o as d,c as p,a as e,i as u,v as r,I as k,t as f,m as L,r as m,F as C,h as D,g as h}from"./index-Gtiy1WfR.js";import{a as g,u as P}from"./axios-lqUOde5C.js";import{m as T}from"./modalMixin-okSyzPCc.js";import{D as V,P as U}from"./PagePagination-Gy4xYwth.js";import{L as E}from"./LoadingComponent-jju5x8oo.js";import"./selector-engine-e6WaDMhI.js";const N={props:["coupon","isNew"],mixins:[T],data(){return{tempCoupon:{},due_date:""}},emits:["update-coupon"],watch:{coupon(){this.tempCoupon=this.coupon;const s=new Date(this.tempCoupon.due_date*1e3).toISOString().split("T");[this.due_date]=s},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}}},R={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},I={class:"modal-dialog",role:"document"},A={class:"modal-content"},S={class:"modal-header"},B={class:"modal-title",id:"exampleModalLabel"},O={key:0},F={key:1},H=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),j={class:"modal-body"},q={class:"mb-3"},z=e("label",{for:"title"},"標題",-1),G={class:"mb-3"},J=e("label",{for:"coupon_code"},"優惠碼",-1),K={class:"mb-3"},Q=e("label",{for:"due_date"},"到期日",-1),W={class:"mb-3"},X=e("label",{for:"price"},"折扣百分比",-1),Y={class:"mb-3"},Z={class:"form-check"},ee=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),te={class:"modal-footer"},oe=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉",-1);function se(s,t,n,c,o,l){return d(),p("div",R,[e("div",I,[e("div",A,[e("div",S,[e("h5",B,[n.isNew?(d(),p("span",O,"新增優惠卷")):(d(),p("span",F,"編輯優惠卷"))]),H]),e("div",j,[e("div",q,[z,u(e("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":t[0]||(t[0]=i=>o.tempCoupon.title=i),placeholder:"請輸入標題"},null,512),[[r,o.tempCoupon.title]])]),e("div",G,[J,u(e("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":t[1]||(t[1]=i=>o.tempCoupon.code=i),placeholder:"請輸入優惠碼"},null,512),[[r,o.tempCoupon.code]])]),e("div",K,[Q,u(e("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":t[2]||(t[2]=i=>o.due_date=i)},null,512),[[r,o.due_date]])]),e("div",W,[X,u(e("input",{type:"number",class:"form-control",id:"price",min:"0","onUpdate:modelValue":t[3]||(t[3]=i=>o.tempCoupon.percent=i),placeholder:"請輸入折扣百分比"},null,512),[[r,o.tempCoupon.percent,void 0,{number:!0}]])]),e("div",Y,[e("div",Z,[u(e("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":t[4]||(t[4]=i=>o.tempCoupon.is_enabled=i),id:"is_enabled"},null,512),[[k,o.tempCoupon.is_enabled]]),ee])])]),e("div",te,[oe,e("button",{type:"button",class:"btn btn-primary",onClick:t[5]||(t[5]=i=>s.$emit("update-coupon",o.tempCoupon))},f(n.isNew?"新增優惠卷":"更新優惠券"),1)])])])],512)}const ne=v(N,[["render",se]]);var ie={VITE_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_PATH:"wei_rio",BASE_URL:"/vue2024_week08/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:_,VITE_PATH:b}=ie,le={components:{CouponModal:ne,DelModal:V,Pagination:U,LoadingComponent:E},data(){return{isLoading:!1,coupons:{},isNew:!1,tempCoupon:{title:"",is_enabled:0,percent:100,code:""},currentPage:1,pagination:{}}},created(){this.getCoupons()},methods:{...L(P,["pushMessage"]),getCoupons(s=1){this.currentPage=s,this.isLoading=!0;const t=`${_}/api/${b}/admin/coupons?page=${s}`;g.get(t).then(n=>{this.coupons=n.data.coupons,this.pagination=n.data.pagination,this.pushMessage({style:"success",title:"取得優惠卷資料",content:n.data.message})}).catch(n=>{this.pushMessage({style:"danger",title:"優惠卷資料取得失敗",content:n.response.data.message})}).finally(()=>{this.isLoading=!1})},openModal(s,t){s==="add"?(this.isNew=!0,this.tempCoupon={due_date:new Date().getTime()/1e3},this.$refs.couponModal.openModal()):s==="edit"?(this.isNew=!1,this.tempCoupon={...t},this.$refs.couponModal.openModal()):s==="del"&&(this.tempCoupon={...t},this.$refs.delCoupon.openModal())},updateCoupon(s){this.isLoading=!0,this.tempCoupon=s;let t=`${_}api/${b}/admin/coupon`,n="post",c=s,o="新增優惠卷";this.isNew||(t=`${_}api/${b}/admin/coupon/${this.tempCoupon.id}`,n="put",c=this.tempCoupon,o="更新優惠卷"),g[n](t,{data:c}).then(l=>{this.pushMessage({style:"success",title:`${o}`,content:l.data.message}),this.getCoupons(this.currentPage),this.$refs.couponModal.hideModal()}).catch(l=>{this.pushMessage({style:"danger",title:"優惠卷刪除失敗",content:l.response.data.message})}).finally(()=>{setTimeout(()=>{this.isLoading=!1},500)})},delCoupon(){this.isLoading=!0;const s=`${_}/api/${b}/admin/coupon/${this.tempCoupon.id}`;g.delete(s).then(t=>{this.pushMessage({style:"success",title:"成功刪除優惠卷",content:t.data.message}),this.getCoupons(this.currentPage),this.$refs.delCoupon.hideModal()}).catch(t=>{this.pushMessage({style:"danger",title:"優惠卷刪除失敗",content:t.response.data.message})}).finally(()=>{setTimeout(()=>{this.isLoading=!1},500)})}}},ae={class:"container"},de={class:"d-flex justify-content-between align-items-center"},pe=e("h2",{class:"my-4 fw-bold"},"優惠卷",-1),ue={class:"table mt-4"},ce=e("thead",null,[e("tr",null,[e("th",null,"名稱"),e("th",null,"折扣百分比"),e("th",null,"到期日"),e("th",{class:"text-center"},"是否啟用"),e("th",null,"編輯")])],-1),re={class:"text-center"},me={key:0,class:"text-success"},he=e("i",{class:"bi bi-check-circle-fill h5"},null,-1),_e=[he],be={key:1,class:"text-danger"},fe=e("i",{class:"bi bi-x-circle-fill h5"},null,-1),ge=[fe],Ce={class:"btn-group flex-sm-row flex-column"},ve=["onClick"],Me=["onClick"];function ye(s,t,n,c,o,l){const i=m("Pagination"),M=m("CouponModal"),y=m("DelModal"),$=m("LoadingComponent");return d(),p(C,null,[e("div",ae,[e("div",de,[pe,e("button",{class:"btn btn-primary",type:"button",onClick:t[0]||(t[0]=a=>l.openModal("add",s.item))}," 建立新的優惠券 ")]),e("table",ue,[ce,e("tbody",null,[(d(!0),p(C,null,D(o.coupons,(a,w)=>(d(),p("tr",{key:w},[e("td",null,f(a.title),1),e("td",null,f(a.percent)+" %",1),e("td",null,f(s.$filters.date(a.due_date)),1),e("td",re,[a.is_enabled?(d(),p("span",me,_e)):(d(),p("span",be,ge))]),e("td",null,[e("div",Ce,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm mb-sm-0 mb-2",onClick:x=>l.openModal("edit",a)}," 編輯 ",8,ve),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:x=>l.openModal("del",a)}," 刪除 ",8,Me)])])]))),128))])]),h(i,{pages:o.pagination,onEmitPages:l.getCoupons},null,8,["pages","onEmitPages"])]),h(M,{coupon:o.tempCoupon,"is-new":o.isNew,onUpdateCoupon:l.updateCoupon,ref:"couponModal"},null,8,["coupon","is-new","onUpdateCoupon"]),h(y,{"out-item":o.tempCoupon,onRemoveData:l.delCoupon,ref:"delCoupon"},null,8,["out-item","onRemoveData"]),h($,{active:o.isLoading,"onUpdate:active":t[1]||(t[1]=a=>o.isLoading=a)},null,8,["active"])],64)}const Pe=v(le,[["render",ye]]);export{Pe as default};
